import*as THREE from"three";import"./style.css";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import vertexShader from"!!raw-loader!./shaders/earthvertexshader.glsl";import fragmentShader from"!!raw-loader!./shaders/earthfragmentshader.glsl";import atmosVertexShader from"!!raw-loader!./shaders/atmosvertexshader.glsl";import atmosFragmentShader from"!!raw-loader!./shaders/atmosfragmentshader.glsl";var scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),renderer=new THREE.WebGLRenderer({canvas:document.querySelector("#bg"),antialias:!0});renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),camera.position.setZ(80),renderer.render(scene,camera);var videoFile=document.getElementById("crtVideo"),videoTexture=new THREE.VideoTexture(videoFile);videoTexture.minFilter=THREE.LinearFilter,videoTexture.magFilter=THREE.LinearFilter;var videoMaterial=new THREE.MeshBasicMaterial({map:videoTexture,side:THREE.FrontSide,toneMapped:!1}),videoGeometry=new THREE.PlaneGeometry(3,3,3),videoScreen=new THREE.Mesh(videoGeometry,videoMaterial);videoScreen.scale.set(.64,.54,1),videoScreen.position.set(8.8,.35,121.02),videoScreen.rotation.set(-.2,0,-.5),scene.add(videoScreen);var pointLight=new THREE.PointLight(16777215);pointLight.position.set(20,20,20);var loadedCRT,ambientLight=new THREE.AmbientLight(16777215);scene.add(pointLight,ambientLight);var loadedSatellite,crtTV=new GLTFLoader;crtTV.load("./models/television/crtEdited.gltf",(function(e){loadedCRT=e,e.scene.position.z=120,e.scene.position.x=9,e.scene.rotation.set(-.2,0,-.5),scene.add(e.scene)}));var satellite=new GLTFLoader;satellite.load("./models/satellite/satellite.gltf",(function(e){loadedSatellite=e,e.scene.position.z=120,e.scene.position.x=12,e.scene.rotation.x=-20,e.scene.rotation.y=-.2,e.scene.rotation.z=-1,scene.add(e.scene)}));var earth=new THREE.Mesh(new THREE.SphereGeometry(5,50,50),new THREE.ShaderMaterial({vertexShader,fragmentShader,uniforms:{earthTex:{value:(new THREE.TextureLoader).load("./images/earth.jpg")}}}));earth.scale.set(10,10,10),scene.add(earth);var earthAtmos=new THREE.Mesh(new THREE.SphereGeometry(5,50,50),new THREE.ShaderMaterial({vertexShader:atmosVertexShader,fragmentShader:atmosFragmentShader,blending:THREE.AdditiveBlending,side:THREE.BackSide,transparent:!0}));earthAtmos.scale.set(12,12,12),scene.add(earthAtmos);var moonTex=(new THREE.TextureLoader).load("./images/moon.jpg"),moonNormalTex=(new THREE.TextureLoader).load("./images/moon_normal.jpg"),moon=new THREE.Mesh(new THREE.SphereGeometry(3,32,32),new THREE.MeshStandardMaterial({map:moonTex,normalMap:moonNormalTex}));moon.position.x=10,moon.scale.set(.5,.5,.5),scene.add(moon);var moonPivot=new THREE.Object3D;earthAtmos.add(moonPivot),moonPivot.add(moon);for(var starGeometry=new THREE.BufferGeometry,starMaterial=new THREE.PointsMaterial({color:16777215}),starVertices=[],i=0;i<1e4;i++){var x=2e3*(Math.random()-.5),y=2e3*(Math.random()-.5),z=2e3*-Math.random();starVertices.push(x,y,z)}starGeometry.setAttribute("position",new THREE.Float32BufferAttribute(starVertices,3));var stars=new THREE.Points(starGeometry,starMaterial);function moveCamera(){var e=document.body.getBoundingClientRect().top;camera.position.z=-.0078*e+80}function animate(){requestAnimationFrame(animate),videoScreen&&videoTexture.update(),loadedSatellite&&(loadedSatellite.scene.rotation.x+=.001),earth.rotation.y+=2e-4,moonPivot.rotation.y+=2e-4,moonPivot.rotation.x=.5,renderer.render(scene,camera)}scene.add(stars),document.body.onscroll=moveCamera,animate();